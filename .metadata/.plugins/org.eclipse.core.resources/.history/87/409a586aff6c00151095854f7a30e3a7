package usernametoname;

import java.awt.Desktop;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.net.URI;

//import org.jsoup.Connection.Response;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;

public class usernametoname {

	/**
	 * @param args
	 */
	static boolean debug =true;
	public static void main(String[] args) {
		
		// TODO Auto-generated method stub
		String Name= "";
		
		console.writeLine("enter username");
		String user=console.readLine();
		
		console.writeLine("looking up name");
		try{			
		Name = getPersonName(user);  	    
		}
		catch(Exception e)
		{
			e.printStackTrace();
		}
		console.writeLine("user name: "+user+"\nmaps to: "+Name);
		String s = "http://widgets.ecs.soton.ac.uk/image.php?id=person_1615&maxw=250&maxh=300&corners=0&edge=1&checksum=127a1847962b216fababe6c7d230e03e";
		try {
			console.writeLine("http://www.degraeve.com/img2txt-yay.php?url="+java.net.URLEncoder.encode(s, "ISO-8859-1")+".jpg&mode=A&size=100&charstr=ABCDEFGHIJKLMNOPQRSTUVWXYZ&order=O&invert=N");
		} catch (UnsupportedEncodingException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		try{			
			console.writeLine( getPersonpicture(user));  	    
			}
			catch(Exception e)
			{
				e.printStackTrace();
			}
		try{
			if(Desktop.isDesktopSupported())
			{
			  Desktop.getDesktop().browse(new URI("http://www.google.com/search?q="+Name.replace(" ","+")+"&btnI"));
			}		
		}
		catch (Exception e)
		{
			e.printStackTrace();
		}
	}

	private static String getPersonName(String user){
		
		String url = "http://www.ecs.soton.ac.uk/people/"+user;
		String itm ="title";
		String Name = getItm(url, itm).split(" \\|")[0];
		return (Name.equals("ECS People"))? "Name not found" : Name;}
		
		
	
	private static String getPersonpicture(String user) {
		String url = "http://www.ecs.soton.ac.uk/people/"+user;
		String itm ="img";
		String attr ="src";
		String Name = getmeta(url, itm,attr);
		return (Name.equals("ECS People")|Name.equals(""))? "image not found" : Name;
	}
	
	private static String getItm(String url, String itm){
		try{
		Document doc = Jsoup.connect(url).followRedirects(true).get();
		Elements newsHeadlines =doc.getElementsByTag(itm);
		String Name=newsHeadlines.first().ownText();
		console.writeLine(newsHeadlines);
		return Name;
		}
		catch (Exception e){
			if (debug)
				e.printStackTrace();
			return "ECS People";
		}
	}
	private static String getmeta(String url, String itm,String attr) throws IOException {
		try {
		Document doc = Jsoup.connect(url).followRedirects(true).get();
		Elements newsHeadlines =doc.getElementsByTag(itm);
		String Name=newsHeadlines.first().attr(attr);
		//console.writeLine("---");
		//console.writeLine(Name);
		//console.writeLine("---");
		return Name;
		}
		catch (Exception e){
			if (debug)
				e.printStackTrace();
			return "ECS People";
		}
		}
	}



class console{
    static BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
    public static boolean writeLine(Object item){
        try{
            System.out.println(item.toString());
            return true;
        }
        catch(Exception e){
            return false;
        }
    }
    public static String readLine(){
        try{
            return console.br.readLine();
            }
        catch(Exception e){
            return null;
        }
    }
}
    

